<!Doctype html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Lojinha de Games</title>
        <hr>
        
        <h4>Lista de games</h4>
        <!-- Adicionando elementos dinamicamente no ul-->
        <button onclick="recarregaPagina()">Atualizar lista</button>
        <ul id="games"></ul>
        <hr>
        <!-- Cadastrando o game -->
        <h4>Novo Game</h4>
        <!-- Criar um botão para recarregar a página -->
         
        <input type="text" name="title" id="title" placeholder="Título"> <br>
        <input type="number" name="year" id="year" placeholder="Ano"> <br>
        <input type="number" name="price" id="price" placeholder="Preço"> <br>
        <button type="button" onclick="createGame()">Criar</button>
    </head>
    <body>
        <script>
            function recarregaPagina(){
                document.location.reload('http://localhost:4002/games');
            }
        </script>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Criando funcao para coletar os inputs-->

            function createGame(){
                let titleInput = document.getElementById("title");
                let yearInput = document.getElementById("year");
                let priceInput = document.getElementById("price");
 
                  // JSON com os dados que vamos encaminhar para o formulário (back-end)
                
                  let game = {
                    title: titleInput.value,
                    year: yearInput.value,
                    price: priceInput.value
                  }
                  console.log(game)
                // Enviando para API 
                axios.post('http://localhost:4002/games', game).then(response  => {
                    if(response.statusCode == 200){
                        Alert("Game cadastrado")
                    }
                })
                .catch(err => {
                    console.log(err);
                })
            }


         // Fazendo requisição 
         axios.get("http://localhost:4002/games").then(response => {
            // Criando a varivel para listar no ul 
                let games = response.data;
                let list  =  document.getElementById('games');
                // percorrer o elemento de games e adicionar dentro do ul
                games.forEach(game => {
                    // Criando um elemento lista 
                    var item = document.createElement('li');
                    // Colocando o nome do game no elemento
                    item.innerHTML = game.title;
                    // Adicionando o item na lista
                    list.appendChild(item);
                })

         }).catch(error => {
            console.log(error);
         });

    </script>
</html>